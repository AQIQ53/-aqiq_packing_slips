[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Packing Slip",
  "enabled": 1,
  "modified": "2024-07-17 14:13:57.182620",
  "module": "Aqiq Packing Slip",
  "name": "Packing Slip with Packing Materials",
  "script": "\n// \treturn this.frm.call({\n// \t\tdoc: this.frm.doc,\n// \t\tmethod: \"get_items\",\n// \t\tcallback: function(r) {\n// \t\t\tif(!r.exc){\n\t\t\t    \n// \t\t\t    cur_frm.refresh();\n// \t\t\t    console.log(cur_frm.doc.items)\n// \t\t\t}\n// \t\t}\n// \t});\n// }\n\ncur_frm.set_query(\"item_code\", \"custom_materials\", function(frm, cdt, cdn) {\n\treturn {\n\t    filters:{\"company\": cur_frm.doc.company, \"disabled\":0, \"is_stock_item\": 1}\n\t}\n});\n\ncur_frm.set_query(\"warehouse\", \"custom_materials\", function(frm, cdt, cdn) {\n\treturn {\n\t    filters:{\"company\": cur_frm.doc.company, \"disabled\":0, \"is_group\": 0}\n\t}\n});\n\nfrappe.ui.form.on('Packing Slip', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\ton_submit(frm){\n\t    frappe.call({\n            method: 'aqiq_packing_slip.services.packing_slip.packing_slip_on_submit',\n            args: {\n                'name':frm.doc.name\n            },\n            callback: function(r) {\n                if (!r.exc) {\n                    // code snippet\n                }\n            }\n        });\n\n\t},\n//  custom_get_items(frm,doc, cdt, cdn) {\n//     frappe.call({\n//             method: 'aqiq_packing_slip.services.packing_slip.get_items',\n//             args: {\n//                 'this_doc':frm.doc.name\n//             },\n//             callback: function(r) {\n//                 if (!r.exc) {\n//                     // code snippet\n//                     console.log(r.message)\n//                     cur_frm.refresh();\n//                     for (var i = 0; i < r.message.length; i++) {\n//                         var new_sales_person = frm.add_child(\"items\", {\n//                             \"item_code\": r.message[i].item_code,\n//                             \"item_name\": r.message[i].item_name,\n//                             \"qty\": r.message[i].qty,\n//                             \"net_weight\": r.message[i].weight_per_unit,\n//                             \"custom_height_mm\": r.message[i].custom_height_mm,\n//                             \"custom_width_mm\": r.message[i].custom_width_mm,\n//                             \"custom_pcs\": r.message[i].custom_pcs,\n//                             \"weight_uom\": r.message[i].weight_uom,\n//                             \"description\": r.message[i].description\n//                         });\n//                     }\n//                     frm.refresh_field('items');\n// \t\t\t //   console.log(cur_frm.doc.items)\n//                 }\n//             }\n//         });\n//  }\n})\n\nfrappe.ui.form.on('Packing Slip Item', {\n    warehouse(frm,cdt,cdn){\n      set_balance(frm,cdt,cdn)  \n    },\n    item_code(frm,cdt,cdn) {\n        var d = locals[cdt][cdn];\n        console.log(\"before_delay\")\n        set_balance(frm,cdt,cdn)\n    },\n    \n});\n\n\nfrappe.ui.form.on('Packing Slip Consumed', {\n    warehouse(frm,cdt,cdn){\n      set_balance(frm,cdt,cdn)  \n    },\n    item_code(frm,cdt,cdn) {\n        var d = locals[cdt][cdn];\n        console.log(\"before_delay\")\n        set_balance(frm,cdt,cdn)\n    },\n    \n});\n\n\n\nvar set_balance = function(frm,cdt,cdn){\n    var d = locals[cdt][cdn];\n    var warehouse = d.warehouse;\n    if(d.item_code && warehouse){\n        frappe.call({\n          method: 'frappe.client.get_value',\n          args: {\n            doctype: 'Bin',\n            filters: {\n              'item_code': d.item_code,\n              'warehouse': warehouse\n            },\n            fieldname: ['actual_qty']\n          },\n          callback: function (data) {\n              if(data.message){\n                frappe.model.set_value(cdt,cdn,\"availability\",data.message.actual_qty)\n              }\n              else{\n                  frappe.model.set_value(cdt,cdn,\"availability\",0)\n              }\n          }\n        });\n    }\n}",
  "view": "Form"
 }
]
